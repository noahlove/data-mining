<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Classification | HW1</title>
  <meta name="description" content="Chapter 4 Classification | HW1" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Classification | HW1" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Classification | HW1" />
  
  
  

<meta name="author" content="Noah Love" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="linear-regresssion.html"/>
<link rel="next" href="linear-model-selection.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Mining</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> A Brief Introduction</a></li>
<li class="chapter" data-level="2" data-path="tidyverse-tools.html"><a href="tidyverse-tools.html"><i class="fa fa-check"></i><b>2</b> Tidyverse tools</a>
<ul>
<li class="chapter" data-level="2.1" data-path="tidyverse-tools.html"><a href="tidyverse-tools.html#select"><i class="fa fa-check"></i><b>2.1</b> Select</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="tidyverse-tools.html"><a href="tidyverse-tools.html#original-data-set"><i class="fa fa-check"></i><b>2.1.1</b> Original Data Set</a></li>
<li class="chapter" data-level="2.1.2" data-path="tidyverse-tools.html"><a href="tidyverse-tools.html#other-select-functions"><i class="fa fa-check"></i><b>2.1.2</b> Other select functions:</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="tidyverse-tools.html"><a href="tidyverse-tools.html#filter"><i class="fa fa-check"></i><b>2.2</b> Filter</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="tidyverse-tools.html"><a href="tidyverse-tools.html#logical-tests-in-r"><i class="fa fa-check"></i><b>2.2.1</b> Logical Tests in R</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="tidyverse-tools.html"><a href="tidyverse-tools.html#mutate"><i class="fa fa-check"></i><b>2.3</b> Mutate</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="tidyverse-tools.html"><a href="tidyverse-tools.html#useful-mutate-functions"><i class="fa fa-check"></i><b>2.3.1</b> Useful mutate functions:</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="tidyverse-tools.html"><a href="tidyverse-tools.html#summarise-summarize"><i class="fa fa-check"></i><b>2.4</b> Summarise / Summarize</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="tidyverse-tools.html"><a href="tidyverse-tools.html#useful-summary-functions"><i class="fa fa-check"></i><b>2.4.1</b> Useful summary functions</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="tidyverse-tools.html"><a href="tidyverse-tools.html#arrange"><i class="fa fa-check"></i><b>2.5</b> Arrange()</a></li>
<li class="chapter" data-level="2.6" data-path="tidyverse-tools.html"><a href="tidyverse-tools.html#group_by"><i class="fa fa-check"></i><b>2.6</b> Group_by()</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="linear-regresssion.html"><a href="linear-regresssion.html"><i class="fa fa-check"></i><b>3</b> Linear Regresssion</a>
<ul>
<li class="chapter" data-level="3.1" data-path="linear-regresssion.html"><a href="linear-regresssion.html#non-linear-data"><i class="fa fa-check"></i><b>3.1</b> Non linear data</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="linear-regresssion.html"><a href="linear-regresssion.html#interactions-subtracting-variables"><i class="fa fa-check"></i><b>3.1.1</b> Interactions + subtracting variables</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="linear-regresssion.html"><a href="linear-regresssion.html#last-trap-ording-of-the-data"><i class="fa fa-check"></i><b>3.2</b> Last trap, ording of the data</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="linear-regresssion.html"><a href="linear-regresssion.html#missing"><i class="fa fa-check"></i><b>3.2.1</b> Missing</a></li>
<li class="chapter" data-level="3.2.2" data-path="linear-regresssion.html"><a href="linear-regresssion.html#glm"><i class="fa fa-check"></i><b>3.2.2</b> GLM</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="classification.html"><a href="classification.html"><i class="fa fa-check"></i><b>4</b> Classification</a>
<ul>
<li class="chapter" data-level="4.1" data-path="classification.html"><a href="classification.html#music-dataset"><i class="fa fa-check"></i><b>4.1</b> Music dataset</a></li>
<li class="chapter" data-level="4.2" data-path="classification.html"><a href="classification.html#logistic-regression-review"><i class="fa fa-check"></i><b>4.2</b> Logistic Regression Review</a></li>
<li class="chapter" data-level="4.3" data-path="classification.html"><a href="classification.html#resampling"><i class="fa fa-check"></i><b>4.3</b> Resampling</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="classification.html"><a href="classification.html#up-sampling"><i class="fa fa-check"></i><b>4.3.1</b> Up-sampling</a></li>
<li class="chapter" data-level="4.3.2" data-path="classification.html"><a href="classification.html#bootstrapping"><i class="fa fa-check"></i><b>4.3.2</b> Bootstrapping</a></li>
<li class="chapter" data-level="4.3.3" data-path="classification.html"><a href="classification.html#cross-validation"><i class="fa fa-check"></i><b>4.3.3</b> Cross Validation</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="classification.html"><a href="classification.html#initial-work"><i class="fa fa-check"></i><b>4.4</b> Initial Work</a></li>
<li class="chapter" data-level="4.5" data-path="classification.html"><a href="classification.html#a-basic-model-with-upsampling"><i class="fa fa-check"></i><b>4.5</b> A basic model with upsampling</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="linear-model-selection.html"><a href="linear-model-selection.html"><i class="fa fa-check"></i><b>5</b> Linear Model Selection</a>
<ul>
<li class="chapter" data-level="5.1" data-path="linear-model-selection.html"><a href="linear-model-selection.html#regression-requires-more-data-than-features"><i class="fa fa-check"></i><b>5.1</b> Regression requires more data than features</a></li>
<li class="chapter" data-level="5.2" data-path="linear-model-selection.html"><a href="linear-model-selection.html#lasso"><i class="fa fa-check"></i><b>5.2</b> Lasso</a></li>
<li class="chapter" data-level="5.3" data-path="linear-model-selection.html"><a href="linear-model-selection.html#simulating-collinearity-sparsity"><i class="fa fa-check"></i><b>5.3</b> simulating collinearity + sparsity</a></li>
<li class="chapter" data-level="5.4" data-path="linear-model-selection.html"><a href="linear-model-selection.html#demo-on-glmnet-functionalities"><i class="fa fa-check"></i><b>5.4</b> Demo on glmnet functionalities</a></li>
<li class="chapter" data-level="5.5" data-path="linear-model-selection.html"><a href="linear-model-selection.html#principal-component-analysis"><i class="fa fa-check"></i><b>5.5</b> Principal Component Analysis</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="linear-model-selection.html"><a href="linear-model-selection.html#principle-component-analysis"><i class="fa fa-check"></i><b>5.5.1</b> Principle Component Analysis</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="linear-model-selection.html"><a href="linear-model-selection.html#typical-machine-learning-approach"><i class="fa fa-check"></i><b>5.6</b> Typical machine learning approach</a></li>
<li class="chapter" data-level="5.7" data-path="linear-model-selection.html"><a href="linear-model-selection.html#what-we-would-do-in-data-mining"><i class="fa fa-check"></i><b>5.7</b> What we would do in data mining</a></li>
<li class="chapter" data-level="5.8" data-path="linear-model-selection.html"><a href="linear-model-selection.html#principal-component-analysis-applied"><i class="fa fa-check"></i><b>5.8</b> Principal Component Analysis Applied!</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="linear-model-selection.html"><a href="linear-model-selection.html#other-example"><i class="fa fa-check"></i><b>5.8.1</b> Other example</a></li>
<li class="chapter" data-level="5.8.2" data-path="linear-model-selection.html"><a href="linear-model-selection.html#explore-the-data"><i class="fa fa-check"></i><b>5.8.2</b> Explore the data</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="linear-model-selection.html"><a href="linear-model-selection.html#pca-on-weather-data-example"><i class="fa fa-check"></i><b>5.9</b> PCA on weather data example</a></li>
<li class="chapter" data-level="5.10" data-path="linear-model-selection.html"><a href="linear-model-selection.html#different-noramlizations"><i class="fa fa-check"></i><b>5.10</b> Different noramlizations</a>
<ul>
<li class="chapter" data-level="5.10.1" data-path="linear-model-selection.html"><a href="linear-model-selection.html#no-normalization"><i class="fa fa-check"></i><b>5.10.1</b> No normalization</a></li>
<li class="chapter" data-level="5.10.2" data-path="linear-model-selection.html"><a href="linear-model-selection.html#centering-and-scaling"><i class="fa fa-check"></i><b>5.10.2</b> Centering and scaling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="comparing-different-models.html"><a href="comparing-different-models.html"><i class="fa fa-check"></i><b>6</b> Comparing different models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="comparing-different-models.html"><a href="comparing-different-models.html#question-0"><i class="fa fa-check"></i><b>6.1</b> Question 0</a></li>
<li class="chapter" data-level="6.2" data-path="comparing-different-models.html"><a href="comparing-different-models.html#question-1"><i class="fa fa-check"></i><b>6.2</b> Question 1</a></li>
<li class="chapter" data-level="6.3" data-path="comparing-different-models.html"><a href="comparing-different-models.html#question-2"><i class="fa fa-check"></i><b>6.3</b> Question 2</a></li>
<li class="chapter" data-level="6.4" data-path="comparing-different-models.html"><a href="comparing-different-models.html#question-3"><i class="fa fa-check"></i><b>6.4</b> Question 3</a></li>
<li class="chapter" data-level="6.5" data-path="comparing-different-models.html"><a href="comparing-different-models.html#question-4"><i class="fa fa-check"></i><b>6.5</b> Question 4</a></li>
<li class="chapter" data-level="6.6" data-path="comparing-different-models.html"><a href="comparing-different-models.html#question-5"><i class="fa fa-check"></i><b>6.6</b> Question 5</a></li>
<li class="chapter" data-level="6.7" data-path="comparing-different-models.html"><a href="comparing-different-models.html#question-6"><i class="fa fa-check"></i><b>6.7</b> Question 6</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="homework-3-project.html"><a href="homework-3-project.html"><i class="fa fa-check"></i><b>7</b> Homework 3 Project</a>
<ul>
<li class="chapter" data-level="7.1" data-path="homework-3-project.html"><a href="homework-3-project.html#hw1"><i class="fa fa-check"></i><b>7.1</b> HW1</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="homework-3-project.html"><a href="homework-3-project.html#q1"><i class="fa fa-check"></i><b>7.1.1</b> Q1</a></li>
<li class="chapter" data-level="7.1.2" data-path="homework-3-project.html"><a href="homework-3-project.html#q2"><i class="fa fa-check"></i><b>7.1.2</b> Q2</a></li>
<li class="chapter" data-level="7.1.3" data-path="homework-3-project.html"><a href="homework-3-project.html#q3"><i class="fa fa-check"></i><b>7.1.3</b> Q3</a></li>
<li class="chapter" data-level="7.1.4" data-path="homework-3-project.html"><a href="homework-3-project.html#q4"><i class="fa fa-check"></i><b>7.1.4</b> Q4</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="homework-3-project.html"><a href="homework-3-project.html#r-markdown"><i class="fa fa-check"></i><b>7.2</b> R Markdown</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">HW1</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="classification" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> Classification</h1>
<div id="music-dataset" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Music dataset</h2>
<p>From the <a href="https://corgis-edu.github.io/corgis/">CORGIS data project</a> I’ve obtained a <a href="https://corgis-edu.github.io/corgis/csv/music/">music dataset</a>.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="classification.html#cb132-1" aria-hidden="true" tabindex="-1"></a>music <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;Datasets/music_hottest_song_only.csv&quot;</span>)</span>
<span id="cb132-2"><a href="classification.html#cb132-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(music<span class="sc">$</span>artist.terms <span class="sc">==</span> <span class="st">&quot;hip hop&quot;</span>)</span>
<span id="cb132-3"><a href="classification.html#cb132-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> music<span class="sc">$</span>song.hotttnesss</span></code></pre></div>
</div>
<div id="logistic-regression-review" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Logistic Regression Review</h2>
<p><span class="math inline">\(Y \sim Binomial(n=1, p(X))\)</span></p>
<p><span class="math inline">\(p(X) = \frac{exp(X\beta)}{\exp(X\beta) + 1}\)</span></p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="classification.html#cb133-1" aria-hidden="true" tabindex="-1"></a>logit <span class="ot">&lt;-</span> <span class="cf">function</span>(x){<span class="fu">exp</span>(x) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(x))}</span>
<span id="cb133-2"><a href="classification.html#cb133-2" aria-hidden="true" tabindex="-1"></a>logistic_obj <span class="ot">&lt;-</span> <span class="cf">function</span>(params, X, y){</span>
<span id="cb133-3"><a href="classification.html#cb133-3" aria-hidden="true" tabindex="-1"></a>  xbeta <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, X) <span class="sc">%*%</span> params</span>
<span id="cb133-4"><a href="classification.html#cb133-4" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">logit</span>(xbeta)</span>
<span id="cb133-5"><a href="classification.html#cb133-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="sc">-</span><span class="fu">sum</span>(<span class="fu">dbinom</span>(y, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>p, <span class="at">log=</span><span class="cn">TRUE</span>)))</span>
<span id="cb133-6"><a href="classification.html#cb133-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb133-7"><a href="classification.html#cb133-7" aria-hidden="true" tabindex="-1"></a><span class="fu">optim</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), logistic_obj, <span class="at">X=</span>x, <span class="at">y=</span>y)</span></code></pre></div>
<pre><code>## $par
## [1] -3.2070659  0.2257483
## 
## $value
## [1] 721.6383
## 
## $counts
## function gradient 
##       63       NA 
## 
## $convergence
## [1] 0
## 
## $message
## NULL</code></pre>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="classification.html#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Wayne created in class</span></span>
<span id="cb135-2"><a href="classification.html#cb135-2" aria-hidden="true" tabindex="-1"></a>my_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> x,</span>
<span id="cb135-3"><a href="classification.html#cb135-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> <span class="fu">binomial</span>(logit))</span>
<span id="cb135-4"><a href="classification.html#cb135-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(my_model)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ x, family = binomial(logit))
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -0.3151  -0.2971  -0.2883  -0.2520   2.6326  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -3.20585    0.07808 -41.059   &lt;2e-16 ***
## x            0.22775    0.12107   1.881   0.0599 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 1446.9  on 4411  degrees of freedom
## Residual deviance: 1443.3  on 4410  degrees of freedom
## AIC: 1447.3
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<p>How to run logistic regression in R?</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="classification.html#cb137-1" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>), <span class="fu">nrow</span>(music), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb137-2"><a href="classification.html#cb137-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-3"><a href="classification.html#cb137-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-4"><a href="classification.html#cb137-4" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> x, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>),</span>
<span id="cb137-5"><a href="classification.html#cb137-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">subset =</span> train)</span>
<span id="cb137-6"><a href="classification.html#cb137-6" aria-hidden="true" tabindex="-1"></a><span class="co">#To use the model, we pass it to the predict function. We pass in the new data</span></span>
<span id="cb137-7"><a href="classification.html#cb137-7" aria-hidden="true" tabindex="-1"></a><span class="co">#We pass in the compliment of the subset we used (train = !test)</span></span>
<span id="cb137-8"><a href="classification.html#cb137-8" aria-hidden="true" tabindex="-1"></a><span class="co">#We also pass in response. </span></span>
<span id="cb137-9"><a href="classification.html#cb137-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-10"><a href="classification.html#cb137-10" aria-hidden="true" tabindex="-1"></a><span class="co">#What is the probability that you think they are a 1 vs a 0</span></span>
<span id="cb137-11"><a href="classification.html#cb137-11" aria-hidden="true" tabindex="-1"></a>test_probs <span class="ot">&lt;-</span></span>
<span id="cb137-12"><a href="classification.html#cb137-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(mod, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x[<span class="sc">!</span>train]), <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb137-13"><a href="classification.html#cb137-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-14"><a href="classification.html#cb137-14" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(test_probs)</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="classification.html#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co">#This should feel absolutely like it is 0 and not one</span></span>
<span id="cb139-2"><a href="classification.html#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(test_probs)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="classification.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Round the numbers</span></span>
<span id="cb140-2"><a href="classification.html#cb140-2" aria-hidden="true" tabindex="-1"></a>test_pred <span class="ot">&lt;-</span> test_probs <span class="sc">&gt;</span> <span class="fl">0.5</span></span>
<span id="cb140-3"><a href="classification.html#cb140-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-4"><a href="classification.html#cb140-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Head the numbers</span></span>
<span id="cb140-5"><a href="classification.html#cb140-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(test_pred)</span></code></pre></div>
<pre><code>##     1     2     3     4     5     6 
## FALSE FALSE FALSE FALSE FALSE FALSE</code></pre>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="classification.html#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co">#How good is my prediction</span></span>
<span id="cb142-2"><a href="classification.html#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="co">#First, how many predications did we get correct</span></span>
<span id="cb142-3"><a href="classification.html#cb142-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-4"><a href="classification.html#cb142-4" aria-hidden="true" tabindex="-1"></a>same_as_data <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(test_pred) <span class="sc">==</span> y[<span class="sc">!</span>train]</span>
<span id="cb142-5"><a href="classification.html#cb142-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(same_as_data)</span></code></pre></div>
<pre><code>## [1] 0.9622054</code></pre>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="classification.html#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co">#About 96 percent. Seems really good.</span></span></code></pre></div>
<p>Then we ask is the data unbalanced if you do you this for cancer in the general population for example. Could be bad if you have 96 percent accuracy</p>
<p>We call this a classification error. The histogram should be a red flag. We are saying everything is 0, and then are just wrong when its 1. Iin this case, every song is not hip hop, and we are right 96% of the time.</p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="center">Y = 1</th>
<th align="right">Y = 0</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><span class="math inline">\(\hat{Y}\)</span> = 1</td>
<td align="center">A</td>
<td align="right">B</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(\hat{Y}\)</span> = 0</td>
<td align="center">C</td>
<td align="right">D</td>
</tr>
</tbody>
</table>
<p><span class="math inline">\(\frac{A}{A + C}\)</span> our recall! Of all the records that are “1”, how many are our model capturing</p>
<p><span class="math inline">\(\frac{B}{B + D}\)</span> our precision! Of all the records that are “1”, how many are our model capturing</p>
<p>The amazing thing is that we can actually make one of these one!</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="classification.html#cb145-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb145-2"><a href="classification.html#cb145-2" aria-hidden="true" tabindex="-1"></a>test_pred <span class="ot">&lt;-</span> test_probs <span class="sc">&gt;</span> alpha</span>
<span id="cb145-3"><a href="classification.html#cb145-3" aria-hidden="true" tabindex="-1"></a>truly1 <span class="ot">&lt;-</span> y[<span class="sc">!</span>train] <span class="sc">==</span><span class="dv">1</span></span>
<span id="cb145-4"><a href="classification.html#cb145-4" aria-hidden="true" tabindex="-1"></a>called1 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(test_pred)</span>
<span id="cb145-5"><a href="classification.html#cb145-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-6"><a href="classification.html#cb145-6" aria-hidden="true" tabindex="-1"></a>recall <span class="ot">&lt;-</span> <span class="fu">sum</span>(called1 <span class="sc">&amp;</span> truly1)<span class="sc">/</span> <span class="fu">sum</span>(truly1)</span>
<span id="cb145-7"><a href="classification.html#cb145-7" aria-hidden="true" tabindex="-1"></a>precision <span class="ot">&lt;-</span> <span class="fu">sum</span>(truly1 <span class="sc">&amp;</span> called1)<span class="sc">/</span> <span class="fu">sum</span>(called1)</span>
<span id="cb145-8"><a href="classification.html#cb145-8" aria-hidden="true" tabindex="-1"></a>recall</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="classification.html#cb147-1" aria-hidden="true" tabindex="-1"></a>precision</span></code></pre></div>
<pre><code>## [1] NaN</code></pre>
<p>Right now the recall is really bad: but lets make everything one and make our recall really good!</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="classification.html#cb149-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb149-2"><a href="classification.html#cb149-2" aria-hidden="true" tabindex="-1"></a>test_pred <span class="ot">&lt;-</span> test_probs <span class="sc">&gt;</span> alpha</span>
<span id="cb149-3"><a href="classification.html#cb149-3" aria-hidden="true" tabindex="-1"></a>truly1 <span class="ot">&lt;-</span> y[<span class="sc">!</span>train] <span class="sc">==</span><span class="dv">1</span></span>
<span id="cb149-4"><a href="classification.html#cb149-4" aria-hidden="true" tabindex="-1"></a>called1 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(test_pred)</span>
<span id="cb149-5"><a href="classification.html#cb149-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-6"><a href="classification.html#cb149-6" aria-hidden="true" tabindex="-1"></a>recall <span class="ot">&lt;-</span> <span class="fu">sum</span>(called1 <span class="sc">&amp;</span> truly1)<span class="sc">/</span> <span class="fu">sum</span>(truly1)</span>
<span id="cb149-7"><a href="classification.html#cb149-7" aria-hidden="true" tabindex="-1"></a>precision <span class="ot">&lt;-</span> <span class="fu">sum</span>(truly1 <span class="sc">&amp;</span> called1)<span class="sc">/</span> <span class="fu">sum</span>(called1)</span>
<span id="cb149-8"><a href="classification.html#cb149-8" aria-hidden="true" tabindex="-1"></a>recall</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="classification.html#cb151-1" aria-hidden="true" tabindex="-1"></a>precision</span></code></pre></div>
<pre><code>## [1] 0.03779458</code></pre>
<p>Now lets make a sequence!</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="classification.html#cb153-1" aria-hidden="true" tabindex="-1"></a>alphas <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">10000</span>)</span>
<span id="cb153-2"><a href="classification.html#cb153-2" aria-hidden="true" tabindex="-1"></a>recalls <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(alphas))</span>
<span id="cb153-3"><a href="classification.html#cb153-3" aria-hidden="true" tabindex="-1"></a>precisions <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(alphas))</span>
<span id="cb153-4"><a href="classification.html#cb153-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-5"><a href="classification.html#cb153-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(alphas)){</span>
<span id="cb153-6"><a href="classification.html#cb153-6" aria-hidden="true" tabindex="-1"></a>  alpha <span class="ot">&lt;-</span> alphas[i]</span>
<span id="cb153-7"><a href="classification.html#cb153-7" aria-hidden="true" tabindex="-1"></a>  test_pred <span class="ot">&lt;-</span> test_probs <span class="sc">&gt;</span> alpha</span>
<span id="cb153-8"><a href="classification.html#cb153-8" aria-hidden="true" tabindex="-1"></a>  truly1 <span class="ot">&lt;-</span> y[<span class="sc">!</span>train] <span class="sc">==</span><span class="dv">1</span></span>
<span id="cb153-9"><a href="classification.html#cb153-9" aria-hidden="true" tabindex="-1"></a>  called1 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(test_pred)</span>
<span id="cb153-10"><a href="classification.html#cb153-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb153-11"><a href="classification.html#cb153-11" aria-hidden="true" tabindex="-1"></a>  recall <span class="ot">&lt;-</span> <span class="fu">sum</span>(called1 <span class="sc">&amp;</span> truly1)<span class="sc">/</span> <span class="fu">sum</span>(truly1)</span>
<span id="cb153-12"><a href="classification.html#cb153-12" aria-hidden="true" tabindex="-1"></a>  precision <span class="ot">&lt;-</span> <span class="fu">sum</span>(truly1 <span class="sc">&amp;</span> called1)<span class="sc">/</span> <span class="fu">sum</span>(called1)</span>
<span id="cb153-13"><a href="classification.html#cb153-13" aria-hidden="true" tabindex="-1"></a>  recall[i] <span class="ot">&lt;-</span> recall</span>
<span id="cb153-14"><a href="classification.html#cb153-14" aria-hidden="true" tabindex="-1"></a>  precision[i] <span class="ot">&lt;-</span> precision</span>
<span id="cb153-15"><a href="classification.html#cb153-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb153-16"><a href="classification.html#cb153-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-17"><a href="classification.html#cb153-17" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(recalls, precisions)</span></span></code></pre></div>
<p>What are the most popular “artist.terms” in the dataset?</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="classification.html#cb154-1" aria-hidden="true" tabindex="-1"></a>artists_sorted <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">table</span>(music<span class="sc">$</span>artist.terms), <span class="at">decreasing =</span>T)</span>
<span id="cb154-2"><a href="classification.html#cb154-2" aria-hidden="true" tabindex="-1"></a>artists_sorted[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## hip hop 
##     171</code></pre>
<ul>
<li>Choose one “artist.terms” to predict for, then try running logistic regression vs usual lm() on all of the other variables, do they pick up different variables? What would your next steps be?</li>
</ul>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="classification.html#cb156-1" aria-hidden="true" tabindex="-1"></a>logit <span class="ot">&lt;-</span> <span class="cf">function</span>(x){<span class="fu">exp</span>(x) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(x))}</span>
<span id="cb156-2"><a href="classification.html#cb156-2" aria-hidden="true" tabindex="-1"></a>logistic_obj <span class="ot">&lt;-</span> <span class="cf">function</span>(params, X, y){</span>
<span id="cb156-3"><a href="classification.html#cb156-3" aria-hidden="true" tabindex="-1"></a>  xbeta <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, X) <span class="sc">%*%</span> params</span>
<span id="cb156-4"><a href="classification.html#cb156-4" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">logit</span>(xbeta)</span>
<span id="cb156-5"><a href="classification.html#cb156-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="sc">-</span><span class="fu">sum</span>(<span class="fu">dbinom</span>(y, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>p, <span class="at">log=</span><span class="cn">TRUE</span>)))</span>
<span id="cb156-6"><a href="classification.html#cb156-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb156-7"><a href="classification.html#cb156-7" aria-hidden="true" tabindex="-1"></a><span class="fu">optim</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), logistic_obj, <span class="at">X=</span>x, <span class="at">y=</span>y)</span></code></pre></div>
<pre><code>## $par
## [1] -3.2070659  0.2257483
## 
## $value
## [1] 721.6383
## 
## $counts
## function gradient 
##       63       NA 
## 
## $convergence
## [1] 0
## 
## $message
## NULL</code></pre>
<p>Imagine you’re doing fake news prediction, what metric(s) would you care more about the most? How would you recommend a target for these metrics for a company like Facebook?</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="classification.html#cb158-1" aria-hidden="true" tabindex="-1"></a>artist_cols <span class="ot">&lt;-</span></span>
<span id="cb158-2"><a href="classification.html#cb158-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">grepl</span>(<span class="st">&quot;^artist&quot;</span>, <span class="fu">names</span>(music))</span>
<span id="cb158-3"><a href="classification.html#cb158-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-4"><a href="classification.html#cb158-4" aria-hidden="true" tabindex="-1"></a>my_mod <span class="ot">&lt;-</span></span>
<span id="cb158-5"><a href="classification.html#cb158-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(y <span class="sc">~</span> ., <span class="at">data =</span> music[,<span class="sc">!</span>artist_cols])</span>
<span id="cb158-6"><a href="classification.html#cb158-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-7"><a href="classification.html#cb158-7" aria-hidden="true" tabindex="-1"></a>ols <span class="ot">&lt;-</span></span>
<span id="cb158-8"><a href="classification.html#cb158-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(y <span class="sc">~</span> ., music[,<span class="sc">!</span>artist_cols])</span></code></pre></div>
<p>We can plot this data and see the relationship!</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="classification.html#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">summary</span>(ols)<span class="sc">$</span>coefficients[, <span class="dv">4</span>], <span class="fu">summary</span>(my_mod)<span class="sc">$</span>coefficients[, <span class="dv">4</span>])</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-53-1.png" width="672" /></p>
<p>If we plot the coefficients, of logistic versus regression, against each other, you will get a very very strong relationship. Things that are significant in one will be significant in the other.</p>
<p>If you only care about what features are important, there is very little difference between logistic and regression. Ultimately, when we are looking at the optimization, there is an xbeta term we created. It is just like in regression. Then you penalize by some magical calculation but eitherway it is all dependent on the xbeta term. In a sense, they are the same category of models.</p>

</div>
<div id="resampling" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Resampling</h2>
<p>Often with inbalanced data sets you want to upsample (or downsample). You can create or get rid of data to make the sample more proportionate.</p>
<p>Alternatively you can Bootstrap the data. It is like asking what is the distribution of something we don’t know. We can use simulation to get a sense of what the distribution is (often used for uncertainty).</p>
<p>However, we always need to avoid overfitting. It is important to also do cross-validation then.</p>
<div id="up-sampling" class="section level3" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Up-sampling</h3>
<div class="figure">
<img src="A:%5CDocuments%5CSemester%206%5Cdata-mining-at-columbia%5CMy%20Class%20Notes%5CImages%5Cupsampling.JPG" alt="" />
<p class="caption">Up-sampling</p>
</div>
<p>It works, but it is important to remember you aren’t creating new data. You are essentially adding more weight to the already existing data. But it does help.</p>
</div>
<div id="bootstrapping" class="section level3" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Bootstrapping</h3>
<p>If the data changes, how much will my model change? You have these questions about slightly different sets. So you create a similar bootstrap sample and do the same model on both. Then you look at the results. By collapsing across the samples (and doing more), you can see how sensitive the data is and how it changes with different inputs.</p>
<div class="figure">
<img src="A:%5CDocuments%5CSemester%206%5Cdata-mining-at-columbia%5CMy%20Class%20Notes%5CImages%5Cbootstrap.JPG" alt="" />
<p class="caption">Bootstrapping</p>
</div>
</div>
<div id="cross-validation" class="section level3" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Cross Validation</h3>
<p>When you generalize beyond the data set you have, how bad is your error? This is the problem of overfitting. You can’t generalize. Cross validation tries to tell you how bad of a problem you have. If you use tuning hyperparameters however, you can help fix this. You can leave part of the original set out to test on later. You switch the training set and validation set for all of the test.</p>
<p>In general, when tuning for hyperparameters (like degrees of polynomials) you ahve to make a choice. For example earlier with polynomials we graphed it using validation and training. Once we pick the optimal hyperparameter from the training set tested on the validation set. Then we apply it onto the test set to get the generalization error.</p>
<p>In short: - Cross validation between train/validation creates the hyperparameter. (i.e. degrees of polynomial) - Then you use all the training and validation data to get the parameters. (coefficients given the polynomial) - Then predict on the test data to get the generalization error.</p>
<p>This should prevent the overfitting from the hyperparameter. If you reapply onto a test set that wasn’t used to help you pick this should tell you if there is a problem.</p>
<p>There is some debate on double cross validation. You can then change the test set and revalidate. Some people argue why not? Our model should be more robust if we cycle through everything.</p>
<p>Reasons not to: Computational. It is resource intesnive. You can also leak data and ruin you generalization error.</p>
</div>
</div>
<div id="initial-work" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Initial Work</h2>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="classification.html#cb160-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;Datasets/small_non_retweets_dc_inaug_steal.csv&quot;</span>)</span>
<span id="cb160-2"><a href="classification.html#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df,<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##       X               created_at
## 1 36998 2021-01-20T17:19:45.000Z
## 2 38336 2021-01-21T13:43:51.000Z
##                                                                                                                                                                                                                                               text
## 1                                                                                                                                                            View of White House and Washington Monument #DC #WashingtonDC https://t.co/YxGxgocXsT
## 2 Fue un momento emotivo para @joebiden y su esposa antes de entrar a la residencia.\n\n@latinostimemagazine \n\n#InaugurationDay #Inauguration #president #usa #residenciapresidencial #washingtondc #latinostimemagazine https://t.co/fbqi7Mx1Md
##   retweet_count reply_count like_count dc_flag inaug_flag steal_flag
## 1             0           0          1    True      False      False
## 2             0           0          0    True       True      False
##   washington.dc biden sentomcotton white.house joebiden hillary amykremer
## 1             0     0            0      0.9123        0       0         0
## 2             0     0            0      0.0000        1       0         0
##   realdonaldtrump trump peter.navarro fox.news biden.inauguration harris
## 1               0     0             0        0                  0      0
## 2               0     0             0        0                  0      0
##   charles.curtis joe.biden kamala.harris jack senschumer sentedcruz
## 1              0         0             0    0          0          0
## 2              0         0             0    0          0          0
##   whitehouse inauguration.day america rudygiuliani kloeffler perduesenate
## 1          0                0       0            0         0            0
## 2          0                0       0            0         0            0
##   gasecofstate beschlossdc facebook twitter youtube d.c. patriots obama
## 1            0           0        0       0       0    0        0     0
## 2            0           0        0       0       0    0        0     0
##   gop capitol joe ali speakerpelosi trumps ap u.s..capitol donald.trump
## 1   0       0   0   0             0      0  0            0            0
## 2   0       0   0   0             0      0  0            0            0
##   scotland tedcruz washingtonpost oann pence senate president.trump god
## 1        0       0              0    0     0      0               0   0
## 2        0       0              0    0     0      0               0   0
##   usatoday dnc democrats president.biden dc potus msnbc nbcnews thehill
## 1        0   0         0               0  0     0     0       0       0
## 2        0   0         0               0  0     0     0       0       0
##   pelosi codemonkeyz jaketapper republicans china newsmax usa florida djt
## 1      0           0          0           0     0       0   0       0   0
## 2      0           0          0           0     0       0   0       0   0
##   nancy.pelosi jesus secret.service rsbnetwork lindseygrahamsc azgop
## 1            0     0              0          0               0     0
## 2            0     0              0          0               0     0
##   secpompeo republican cnn gatewaypundit yahoo vice.president americans
## 1         0          0   0             0     0              0         0
## 2         0          0   0             0     0              0         0
##   llinwood briankempga jackposobiec foxnews texas realmattcouch
## 1        0           0            0       0     0             0
## 2        0           0            0       0     0             0
##   seanhannity ingrahamangle congress ossoff mayorbowser
## 1           0             0        0      0           0
## 2           0             0        0      0           0
##   united.states.of.america kamala jimmy.carter covid u.s. cbsnews vp
## 1                        0      0            0     0    0       0  0
## 2                        0      0            0     0    0       0  0
##   randpaul gopleader tuckercarlson senronjohnson donald senatemajldr
## 1        0         0             0             0      0            0
## 2        0         0             0             0      0            0
##   kamalaharris iraq us kayleighmcenany pentagon republican.party
## 1            0    0  0               0        0                0
## 2            0    0  0               0        0                0
##   tomfitton mtgreenee dems thedemocrats georgia housegop senategop
## 1         0         0    0            0       0        0         0
## 2         0         0    0            0       0        0         0
##   senatorromney fbi iran barackobama jim_jordan ivanka donwinslow
## 1             0   0    0           0          0      0          0
## 2             0   0    0           0          0      0          0
##   sethabramson airbnb abc google senkamalaharris united.states washington
## 1            0      0   0      0               0             0          0
## 2            0      0   0      0               0             0          0
##   president.donald.trump hawleymo richardgrenell gopchairwoman
## 1                      0        0              0             0
## 2                      0        0              0             0
##   projectlincoln flotus nytimes parlertakes marcorubio sendavidperdue
## 1              0      0       0           0          0              0
## 2              0      0       0           0          0              0
##   senatorloeffler jennaellisesq garepublicans drbiden donaldjtrumpjr
## 1               0             0             0       0              0
## 2               0             0             0       0              0
##   repmattgaetz tomilahren johncornyn mariabartiromo chuckgrassley aoc
## 1            0          0          0              0             0   0
## 2            0          0          0              0             0   0
##   catturd2 sexcounseling danscavino sidneypowell1 mike_pence sebgorka
## 1        0             0          0             0          0        0
## 2        0             0          0             0          0        0
##   senrickscott repkinzinger democrat epochtimes ivankatrump nypost
## 1            0            0        0          0           0      0
## 2            0            0        0          0           0      0
##   breitbartnews lisamurkowski sentoomey cnnbrk cia cbs nbc sensanders
## 1             0             0         0      0   0   0   0          0
## 2             0             0         0      0   0   0   0          0
##   genflynn mcconnell blm erictrump amyklobuchar berniesanders lord
## 1        0         0   0         0            0             0    0
## 2        0         0   0         0            0             0    0
##   cnnpolitics russia laurenboebert senatedems wusa9 hbwx tenacioustopper
## 1           0      0             0          0     0    0               0
## 2           0      0             0          0     0    0               0
##   miriweather washington.d.c. アメリカ washingtondc dctogogo canada
## 1           0               0        0            0        0      0
## 2           0               0        0            0        0      0
##   reuters antifa virginia statedept wsj npr bbcworld
## 1       0      0        0         0   0   0        0
## 2       0      0        0         0   0   0        0
##   the.rhythm.and.blues.presidential.inaugural.ball randbreloaded
## 1                                                0             0
## 2                                                0             0
##   mike.pence dcpolicedept us.capitol maryland thejusticedept election.day
## 1          0            0          0        0              0            0
## 2          0            0          0        0              0            0
##   india national.guard president acosta bideninaugural transition46
## 1     0              0         0      0              0            0
## 2     0              0         0      0              0            0
##   politico narendramodi hillaryclinton estados.unidos amazon
## 1        0            0              0              0      0
## 2        0            0              0              0      0
##   secretservice george.w..bush andrewfeinberg dhsgov michelleobama bernie
## 1             0              0              0      0             0      0
## 2             0              0              0      0             0      0
##   dmvblacklives fbiwfo nationalguard guardia.nacional capitol.hill
## 1             0      0             0                0            0
## 2             0      0             0                0            0
##   national.mall capitol.police bernie.sanders presssec nbc.news
## 1             0              0              0        0        0
## 2             0              0              0        0        0
##   disclosetv u.s.capitol.building afghanistan browns steven.m..d.antuono
## 1          0                    0           0      0                   0
## 2          0                    0           0      0                   0
##   wapo marvel lady.gaga ustreasury jrpsaki リンカーン大統領.新聞社300社
## 1    0      0         0          0       0                            0
## 2    0      0         0          0       0                            0
##   選挙クーデター hotnews8net amanda.gorman theamandagorman
## 1              0           0             0               0
## 2              0           0             0               0</code></pre>
<p>Let’s understand the flags, like steal_flag.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="classification.html#cb162-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>steal_flag <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>steal_flag <span class="sc">==</span> <span class="st">&quot;True&quot;</span>)</span>
<span id="cb162-2"><a href="classification.html#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(df<span class="sc">$</span>steal_flag)</span></code></pre></div>
<pre><code>## [1] 0.01701149</code></pre>
<p>We are turning true or false into 0 or 1. This flag is rare. It is about 1.7 percent.</p>
<p>Steal means if the word “steal” was present in a tweet. We can examine some of them for example by using:</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="classification.html#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df[df<span class="sc">$</span>steal_flag <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">&quot;text&quot;</span>], <span class="dv">4</span>)</span></code></pre></div>
<pre><code>## [1] @Rob_Noorollah @Christi76673318 Pick up a copy of Biden&#39;s new book... \n\n&quot;The Art of the Steal&quot;\n\n#StopTheSteaI2020                                                                                  
## [2] @SraBlockerFV @EFtours What would be great is if you ddn’t steal $1000 from my kids after you candled their tour! #StopTheSteaI2020 #TheMoreYouKnow #WakeUpSlowM                                       
## [3] #SecretService is gonna get you for revealing @realDonaldTrump&#39;s codename! \n\n#FightBack PATRIOTS \n#StopTheSteal \n#4MoreYears \n#Jan6GuestHouse \n#Jan6Rides \n#WashingtonDC https://t.co/P9NkJQ5KLI
## [4] Me, heading to Tampa to Stop Brady’s Steal. Saints won in a landslide. We need to take our NFL back! #StopTheSteaI2020 https://t.co/OTL8nADgAY                                                         
## 4279 Levels: ¿Qué hacía ayer @realDonaldTrump mientras tomaban el Capitolio en #WashingtonDC? \n\nEn las imágenes se aprecia a Trump y su hija @IvankaTrump observando diversas pantallas que mostraban que lo ocurría en Washington DC, mientras en el fondo se escucha la canción &#39;Gloria&#39;. https://t.co/i3Cyhc0mTF ...</code></pre>
</div>
<div id="a-basic-model-with-upsampling" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> A basic model with upsampling</h2>
<p>We can create a new data object that stores only the indices of the places where steal_flag exists.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="classification.html#cb166-1" aria-hidden="true" tabindex="-1"></a>pos_ind <span class="ot">&lt;-</span> <span class="fu">which</span>(df<span class="sc">$</span>steal_flag <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb166-2"><a href="classification.html#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pos_ind)</span></code></pre></div>
<pre><code>## [1]  28  91 114 171 176 285</code></pre>
<p>So in this case, tweets 28, 91, 114… etc have the word steal.</p>
<p>Let’s sample the indices now. This requires us to figure out what we want to upsample our data to. To do so we will make N 10 times the length of our current amount of steal_flags. What we are doing is artificially increasing our data set. Upsampling is somewhat of a hack in the sense. It makes the objective function give more weight to the positive yet rare cases in our data. It is sorta dirty but also helpful, especially for preliminary exploration. There are other ways to be better at weighing certain aspects.</p>
<p>Note: you can also downsample the data. However, this is much more rare. It should have a very similar affect but usually you don’t want to throw data away!</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="classification.html#cb168-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">length</span>(pos_ind)<span class="sc">*</span><span class="dv">10</span></span>
<span id="cb168-2"><a href="classification.html#cb168-2" aria-hidden="true" tabindex="-1"></a>sample_ind <span class="ot">&lt;-</span> <span class="fu">sample</span>(pos_ind, N, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="classification.html#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(sample_ind)</span></code></pre></div>
<pre><code>## sample_ind
##   28   91  114  171  176  285  311  364  429  509  636  719  789  821 
##    9   11   15   13   11   14    8   12    7    5   11    5    9    8 
##  835  951 1063 1120 1339 1346 1401 1523 1561 1580 1607 1826 1854 1963 
##   13   12   15   10   11    6    5    7    5    9   10   11    7   10 
## 2050 2063 2082 2193 2244 2326 2453 2465 2578 2701 2702 2853 2927 2949 
##    8   16   14    6   11    8    5   14   12    8    8   11    7    9 
## 3084 3147 3198 3281 3297 3311 3387 3424 3537 3543 3554 3574 3577 3615 
##    8   10    8    8   11   14   13   11   12    7    3   11   13   15 
## 3678 3686 3699 3723 3740 3755 3791 3868 3894 3923 3946 3955 3984 4032 
##   11   13    9   14    8   11   15    9   10   10   10   14    7   10 
## 4076 4125 4136 4262 
##    7   12   12    8</code></pre>
<p>This table shows the number of times we get each entry. The above number is the specific record and below it is the number of times.</p>
<p>So let’s create a new dataframe. We want to grab the particular indices from the above dataframe multiple times. Something like this seems intuitive.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="classification.html#cb171-1" aria-hidden="true" tabindex="-1"></a>new_df <span class="ot">&lt;-</span> df[sample_ind,]</span></code></pre></div>
<p>However there is a major problem!</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="classification.html#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(new_df)</span></code></pre></div>
<pre><code>## [1] 740 259</code></pre>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="classification.html#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df)</span></code></pre></div>
<pre><code>## [1] 4350  259</code></pre>
<p>We lost a lot of cases! In fact, we threw away all of the negative cases. So instead, we need to stack the dataframes together.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="classification.html#cb176-1" aria-hidden="true" tabindex="-1"></a>new_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df[sample_ind, ], df)</span>
<span id="cb176-2"><a href="classification.html#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(new_df)</span></code></pre></div>
<pre><code>## [1] 5090  259</code></pre>
<p>Note the features themselves haven’t changed at all. Instead, the proportion of the features have changed. There we go. Also note we did not overwrite df, we created a new dataframe. This is good practice in functional programming. Now we can do things like linear regression!</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="classification.html#cb178-1" aria-hidden="true" tabindex="-1"></a>ols <span class="ot">&lt;-</span> <span class="fu">lm</span>(steal_flag <span class="sc">~</span> trump <span class="sc">+</span> capitol.police, <span class="at">data =</span> new_df)</span>
<span id="cb178-2"><a href="classification.html#cb178-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ols)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = steal_flag ~ trump + capitol.police, data = new_df)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -0.1672 -0.1672 -0.1672 -0.1141  0.8862 
## 
## Coefficients:
##                 Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)     0.167170   0.005525  30.259  &lt; 2e-16 ***
## trump          -0.053420   0.015169  -3.522 0.000433 ***
## capitol.police -0.305764   0.493761  -0.619 0.535777    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.3662 on 5087 degrees of freedom
## Multiple R-squared:  0.002501,   Adjusted R-squared:  0.002109 
## F-statistic: 6.377 on 2 and 5087 DF,  p-value: 0.001714</code></pre>
<p>Regressing with trump and capitol police, it appears capitol police isn’t significant but trump is. That is his slogan so it shouldn’t be too surprising but there it is.</p>
<p>How to mix upsample and also cross validate can only be done one way. You <em>don’t</em> want to upsample first! If you did that, you could end up with the same record in both the train and test. Then you would be too confident in those cases.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="linear-regresssion.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="linear-model-selection.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/noahlove/data-mining/edit/master/04-classification.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/noahlove/data-mining/blob/master/04-classification.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
